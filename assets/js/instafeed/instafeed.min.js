(function(){var a;a=(function(){function b(f,c){var d,e;this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",links:true,mock:false,useHttp:false};if(typeof f==="object"){for(d in f){e=f[d];this.options[d]=e}}this.context=c!=null?c:this;this.unique=this._genKey()}b.prototype.hasNext=function(){return typeof this.context.nextUrl==="string"&&this.context.nextUrl.length>0};b.prototype.next=function(){if(!this.hasNext()){return false}return this.run(this.context.nextUrl)};b.prototype.run=function(e){var f,c,d;if(typeof this.options.clientId!=="string"){if(typeof this.options.accessToken!=="string"){throw new Error("Missing clientId or accessToken.")}}if(typeof this.options.accessToken!=="string"){if(typeof this.options.clientId!=="string"){throw new Error("Missing clientId or accessToken.")}}if((this.options.before!=null)&&typeof this.options.before==="function"){this.options.before.call(this)}if(typeof document!=="undefined"&&document!==null){d=document.createElement("script");d.id="instafeed-fetcher";d.src=e||this._buildUrl();f=document.getElementsByTagName("head");f[0].appendChild(d);c="instafeedCache"+this.unique;window[c]=new b(this.options,this);window[c].unique=this.unique}return true};b.prototype.parse=function(d){var n,D,C,y,J,t,c,E,g,s,F,u,f,H,K,r,O,I,x,N,q,M,B,z,G,o,m,w,A,p,l,v,L;if(typeof d!=="object"){if((this.options.error!=null)&&typeof this.options.error==="function"){this.options.error.call(this,"Invalid JSON data");return false}else{throw new Error("Invalid JSON response")}}if(d.meta.code!==200){if((this.options.error!=null)&&typeof this.options.error==="function"){this.options.error.call(this,d.meta.error_message);return false}else{throw new Error("Error from Instagram: "+d.meta.error_message)}}if(d.data.length===0){if((this.options.error!=null)&&typeof this.options.error==="function"){this.options.error.call(this,"No images were returned from Instagram");return false}else{throw new Error("No images were returned from Instagram")}}if((this.options.success!=null)&&typeof this.options.success==="function"){this.options.success.call(this,d)}this.context.nextUrl="";if(d.pagination!=null){this.context.nextUrl=d.pagination.next_url}if(this.options.sortBy!=="none"){if(this.options.sortBy==="random"){l=["","random"]}else{l=this.options.sortBy.split("-")}p=l[0]==="least"?true:false;switch(l[1]){case"random":d.data.sort(function(){return 0.5-Math.random()});break;case"recent":d.data=this._sortBy(d.data,"created_time",p);break;case"liked":d.data=this._sortBy(d.data,"likes.count",p);break;case"commented":d.data=this._sortBy(d.data,"comments.count",p);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}}if((typeof document!=="undefined"&&document!==null)&&this.options.mock===false){r=d.data;A=parseInt(this.options.limit,10);if((this.options.limit!=null)&&r.length>A){r=r.slice(0,A)}c=document.createDocumentFragment();if((this.options.filter!=null)&&typeof this.options.filter==="function"){r=this._filter(r,this.options.filter)}if((this.options.template!=null)&&typeof this.options.template==="string"){g="";H="";N="";L=document.createElement("div");for(F=0,G=r.length;F<G;F++){u=r[F];f=u.images[this.options.resolution];if(typeof f!=="object"){t="No image found for resolution: "+this.options.resolution+".";throw new Error(t)}q=f.width;I=f.height;x="square";if(q>I){x="landscape"}if(q<I){x="portrait"}K=f.url;s=window.location.protocol.indexOf("http")>=0;if(s&&!this.options.useHttp){K=K.replace(/https?:\/\//,"//")}H=this._makeTemplate(this.options.template,{model:u,id:u.id,link:u.link,type:u.type,image:K,width:q,height:I,orientation:x,caption:this._getObjectProperty(u,"caption.text"),likes:u.likes.count,comments:u.comments.count,location:this._getObjectProperty(u,"location.name")});g+=H}L.innerHTML=g;y=[];C=0;D=L.childNodes.length;while(C<D){y.push(L.childNodes[C]);C+=1}for(B=0,o=y.length;B<o;B++){w=y[B];c.appendChild(w)}}else{for(z=0,m=r.length;z<m;z++){u=r[z];O=document.createElement("img");f=u.images[this.options.resolution];if(typeof f!=="object"){t="No image found for resolution: "+this.options.resolution+".";throw new Error(t)}K=f.url;s=window.location.protocol.indexOf("http")>=0;if(s&&!this.options.useHttp){K=K.replace(/https?:\/\//,"//")}O.src=K;if(this.options.links===true){n=document.createElement("a");n.href=u.link;n.appendChild(O);c.appendChild(n)}else{c.appendChild(O)}}}v=this.options.target;if(typeof v==="string"){v=document.getElementById(v)}if(v==null){t='No element with id="'+this.options.target+'" on page.';throw new Error(t)}v.appendChild(c);E=document.getElementsByTagName("head")[0];E.removeChild(document.getElementById("instafeed-fetcher"));M="instafeedCache"+this.unique;window[M]=void 0;try{delete window[M]}catch(h){J=h}}if((this.options.after!=null)&&typeof this.options.after==="function"){this.options.after.call(this)}return true};b.prototype._buildUrl=function(){var d,e,c;d="https://api.instagram.com/v1";switch(this.options.get){case"popular":e="media/popular";break;case"tagged":if(!this.options.tagName){throw new Error("No tag name specified. Use the 'tagName' option.")}e="tags/"+this.options.tagName+"/media/recent";break;case"location":if(!this.options.locationId){throw new Error("No location specified. Use the 'locationId' option.")}e="locations/"+this.options.locationId+"/media/recent";break;case"user":if(!this.options.userId){throw new Error("No user specified. Use the 'userId' option.")}e="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}c=d+"/"+e;if(this.options.accessToken!=null){c+="?access_token="+this.options.accessToken}else{c+="?client_id="+this.options.clientId}if(this.options.limit!=null){c+="&count="+this.options.limit}c+="&callback=instafeedCache"+this.unique+".parse";return c};b.prototype._genKey=function(){var c;c=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return""+(c())+(c())+(c())+(c())};b.prototype._makeTemplate=function(d,g){var c,f,e,i,h;f=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/;c=d;while(f.test(c)){i=c.match(f)[1];h=(e=this._getObjectProperty(g,i))!=null?e:"";c=c.replace(f,function(){return""+h})}return c};b.prototype._getObjectProperty=function(c,f){var d,e;f=f.replace(/\[(\w+)\]/g,".$1");e=f.split(".");while(e.length){d=e.shift();if((c!=null)&&d in c){c=c[d]}else{return null}}return c};b.prototype._sortBy=function(e,d,c){var f;f=function(h,g){var j,i;j=this._getObjectProperty(h,d);i=this._getObjectProperty(g,d);if(c){if(j>i){return 1}else{return -1}}if(j<i){return 1}else{return -1}};e.sort(f.bind(this));return e};b.prototype._filter=function(d,g){var j,f,e,h,c;j=[];f=function(i){if(g(i)){return j.push(i)}};for(e=0,c=d.length;e<c;e++){h=d[e];f(h)}return j};return b})();(function(b,c){if(typeof define==="function"&&define.amd){return define([],c)}else{if(typeof module==="object"&&module.exports){return module.exports=c()}else{return b.Instafeed=c()}}})(this,function(){return a})}).call(this);